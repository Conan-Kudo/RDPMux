<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>RDPMux: RDPListener Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">RDPMux
   &#160;<span id="projectnumber">0.1.0</span>
   </div>
   <div id="projectbrief">RDP server multiplexer designed to work with virtual machine framebuffers.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classRDPListener.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="classRDPListener-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">RDPListener Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>C++ class wrapping the freerdp_listener struct associated with the RDP server.  
 <a href="classRDPListener.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="RDPListener_8h_source.html">RDPListener.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a86867078a182cd3c7bb0af59623b32c2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRDPListener.html#a86867078a182cd3c7bb0af59623b32c2">RDPListener</a> (nn::socket *sock)</td></tr>
<tr class="memdesc:a86867078a182cd3c7bb0af59623b32c2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the listener, given a nanomsg socket to communicate through.  <a href="#a86867078a182cd3c7bb0af59623b32c2">More...</a><br /></td></tr>
<tr class="separator:a86867078a182cd3c7bb0af59623b32c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39d2bbab3d12a70f4eca761dc160f12f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a39d2bbab3d12a70f4eca761dc160f12f"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRDPListener.html#a39d2bbab3d12a70f4eca761dc160f12f">~RDPListener</a> ()</td></tr>
<tr class="memdesc:a39d2bbab3d12a70f4eca761dc160f12f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Safely cleans up the freerdp_listener struct and frees all WinPR objects. <br /></td></tr>
<tr class="separator:a39d2bbab3d12a70f4eca761dc160f12f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a529514b79af91c02b409c094553e520f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRDPListener.html#a529514b79af91c02b409c094553e520f">RunServer</a> (uint16_t port)</td></tr>
<tr class="memdesc:a529514b79af91c02b409c094553e520f"><td class="mdescLeft">&#160;</td><td class="mdescRight">starts the listener subroutine and loops forever on incoming connections.  <a href="#a529514b79af91c02b409c094553e520f">More...</a><br /></td></tr>
<tr class="separator:a529514b79af91c02b409c094553e520f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee843f0bdc6c13a118c98a10b03ad6e6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRDPListener.html#aee843f0bdc6c13a118c98a10b03ad6e6">processDisplayUpdate</a> (std::vector&lt; uint32_t &gt; msg)</td></tr>
<tr class="memdesc:aee843f0bdc6c13a118c98a10b03ad6e6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Processes display updates and sends them to peers.  <a href="#aee843f0bdc6c13a118c98a10b03ad6e6">More...</a><br /></td></tr>
<tr class="separator:aee843f0bdc6c13a118c98a10b03ad6e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6068640d6784523fe1eef7a7dac59bcd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRDPListener.html#a6068640d6784523fe1eef7a7dac59bcd">processDisplaySwitch</a> (std::vector&lt; uint32_t &gt; msg, int vm_id)</td></tr>
<tr class="memdesc:a6068640d6784523fe1eef7a7dac59bcd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Processes display switch events and sends them to peers.  <a href="#a6068640d6784523fe1eef7a7dac59bcd">More...</a><br /></td></tr>
<tr class="separator:a6068640d6784523fe1eef7a7dac59bcd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1c04d8e85fa236d79454847b123ad5b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRDPListener.html#aa1c04d8e85fa236d79454847b123ad5b">registerPeer</a> (<a class="el" href="classRDPPeer.html">RDPPeer</a> *peer)</td></tr>
<tr class="memdesc:aa1c04d8e85fa236d79454847b123ad5b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Registers a peer with the <a class="el" href="classRDPListener.html" title="C++ class wrapping the freerdp_listener struct associated with the RDP server. ">RDPListener</a>.  <a href="#aa1c04d8e85fa236d79454847b123ad5b">More...</a><br /></td></tr>
<tr class="separator:aa1c04d8e85fa236d79454847b123ad5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad9bbf886170c24baf9baeb0526f3e83c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRDPListener.html#ad9bbf886170c24baf9baeb0526f3e83c">unregisterPeer</a> (<a class="el" href="classRDPPeer.html">RDPPeer</a> *peer)</td></tr>
<tr class="memdesc:ad9bbf886170c24baf9baeb0526f3e83c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unregisters a Peer.  <a href="#ad9bbf886170c24baf9baeb0526f3e83c">More...</a><br /></td></tr>
<tr class="separator:ad9bbf886170c24baf9baeb0526f3e83c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa0e7c3e1b4480220bb958109e87e9765"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRDPListener.html#aa0e7c3e1b4480220bb958109e87e9765">GetWidth</a> ()</td></tr>
<tr class="memdesc:aa0e7c3e1b4480220bb958109e87e9765"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the width of the framebuffer.  <a href="#aa0e7c3e1b4480220bb958109e87e9765">More...</a><br /></td></tr>
<tr class="separator:aa0e7c3e1b4480220bb958109e87e9765"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b3ea4b48512683a79a792faebd8f3b8"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRDPListener.html#a8b3ea4b48512683a79a792faebd8f3b8">GetHeight</a> ()</td></tr>
<tr class="memdesc:a8b3ea4b48512683a79a792faebd8f3b8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the height of the framebuffer.  <a href="#a8b3ea4b48512683a79a792faebd8f3b8">More...</a><br /></td></tr>
<tr class="separator:a8b3ea4b48512683a79a792faebd8f3b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a585191d2269906f4b330141e9d248b5c"><td class="memItemLeft" align="right" valign="top">pixman_format_code_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRDPListener.html#a585191d2269906f4b330141e9d248b5c">GetFormat</a> ()</td></tr>
<tr class="memdesc:a585191d2269906f4b330141e9d248b5c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the pixel format of the framebuffer.  <a href="#a585191d2269906f4b330141e9d248b5c">More...</a><br /></td></tr>
<tr class="separator:a585191d2269906f4b330141e9d248b5c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a9bd3bcb75443eedf347add6b185509d9"><td class="memItemLeft" align="right" valign="top">freerdp_listener *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRDPListener.html#a9bd3bcb75443eedf347add6b185509d9">listener</a></td></tr>
<tr class="memdesc:a9bd3bcb75443eedf347add6b185509d9"><td class="mdescLeft">&#160;</td><td class="mdescRight">The freerdp_listener struct this object manages.  <a href="#a9bd3bcb75443eedf347add6b185509d9">More...</a><br /></td></tr>
<tr class="separator:a9bd3bcb75443eedf347add6b185509d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2aaffa65988b4ea4d8021cb0cee994fe"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2aaffa65988b4ea4d8021cb0cee994fe"></a>
void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classRDPListener.html#a2aaffa65988b4ea4d8021cb0cee994fe">shm_buffer</a></td></tr>
<tr class="memdesc:a2aaffa65988b4ea4d8021cb0cee994fe"><td class="mdescLeft">&#160;</td><td class="mdescRight">The shared memory region containing the framebuffer. Always 32 MB big. <br /></td></tr>
<tr class="separator:a2aaffa65988b4ea4d8021cb0cee994fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>C++ class wrapping the freerdp_listener struct associated with the RDP server. </p>
<p>This class manages peer connections, provides RAII abstractions for the setup and teardown of the freerdp_listener struct, provides accessor methods for the state of the framebuffer, etc. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a86867078a182cd3c7bb0af59623b32c2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">RDPListener::RDPListener </td>
          <td>(</td>
          <td class="paramtype">nn::socket *&#160;</td>
          <td class="paramname"><em>sock</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the listener, given a nanomsg socket to communicate through. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sock</td><td>The nanomsg socket to use for communication. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a585191d2269906f4b330141e9d248b5c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pixman_format_code_t RDPListener::GetFormat </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Gets the pixel format of the framebuffer. </p>
<dl class="section return"><dt>Returns</dt><dd>The pixel format of the framebuffer. </dd></dl>

</div>
</div>
<a class="anchor" id="a8b3ea4b48512683a79a792faebd8f3b8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t RDPListener::GetHeight </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Gets the height of the framebuffer. </p>
<dl class="section return"><dt>Returns</dt><dd>The height of the framebuffer. </dd></dl>

</div>
</div>
<a class="anchor" id="aa0e7c3e1b4480220bb958109e87e9765"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t RDPListener::GetWidth </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Gets the width of the framebuffer. </p>
<dl class="section return"><dt>Returns</dt><dd>The width of the framebuffer. </dd></dl>

</div>
</div>
<a class="anchor" id="a6068640d6784523fe1eef7a7dac59bcd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RDPListener::processDisplaySwitch </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; uint32_t &gt;&#160;</td>
          <td class="paramname"><em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>vm_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Processes display switch events and sends them to peers. </p>
<p>The listener first retrieves the framebuffer format, width, and height from the deserialized message passed in. It then mmaps() the shared memory region containing the new framebuffer if necessary (usually only happens the first time a display switch event is received, during initialization) and notifies all connected peers to perform a full screen refresh using <a class="el" href="classRDPPeer.html#a489a0833bc256165a7d4637f89bcb028" title="Recreates the surface object associated with this framebuffer and sends a full display update to the ...">RDPPeer::FullDisplayUpdate</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>The deserialized display switch message. Should be guaranteed by caller to be from a message of type DISPLAY_SWITCH. </td></tr>
    <tr><td class="paramname">vm_id</td><td>The ID of the VM. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="aee843f0bdc6c13a118c98a10b03ad6e6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RDPListener::processDisplayUpdate </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; uint32_t &gt;&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Processes display updates and sends them to peers. </p>
<p>The listener first retrieves the update parameters from the deserialized message passed in. It then sends a display update to all connected peers (which are sharing the same VM session and framebuffer) in a thread-safe manner. This prevents connection threads from updating the list of connected peers while an update is in-flight. It then sends back the DISPLAY_UPDATE_COMPLETE message to the VM.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">msg</td><td>The deserialized update message. Should be guaranteed by caller to be from a message of type DISPLAY_UPDATE. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="aa1c04d8e85fa236d79454847b123ad5b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RDPListener::registerPeer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classRDPPeer.html">RDPPeer</a> *&#160;</td>
          <td class="paramname"><em>peer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Registers a peer with the <a class="el" href="classRDPListener.html" title="C++ class wrapping the freerdp_listener struct associated with the RDP server. ">RDPListener</a>. </p>
<p>Registers a peer with its parent listener in a thread-safe manner. The listener passes down display events to the registered peers for encoding and transmission to their connected clients.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">peer</td><td>Peer to be registered. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a529514b79af91c02b409c094553e520f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RDPListener::RunServer </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>port</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>starts the listener subroutine and loops forever on incoming connections. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">port</td><td>The port to listen on. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ad9bbf886170c24baf9baeb0526f3e83c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void RDPListener::unregisterPeer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classRDPPeer.html">RDPPeer</a> *&#160;</td>
          <td class="paramname"><em>peer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unregisters a Peer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">peer</td><td>Peer to be un-registered. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="a9bd3bcb75443eedf347add6b185509d9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">freerdp_listener* RDPListener::listener</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The freerdp_listener struct this object manages. </p>
<p>This is the actual FreeRDP listener struct that holds most of the real internal state of the RDP listener itself. This class is essentially an overgrown wrapper for this object. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>include/rdp/<a class="el" href="RDPListener_8h_source.html">RDPListener.h</a></li>
<li>src/rdp/RDPListener.cpp</li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="classRDPListener.html">RDPListener</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.10 </li>
  </ul>
</div>
</body>
</html>
